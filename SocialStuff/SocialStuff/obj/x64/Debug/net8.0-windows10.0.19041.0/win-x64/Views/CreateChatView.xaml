<Page x:ConnectionId='1'
    x:Class="SocialStuff.Views.CreateChatView"
    x:Name="CreateChat"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:vm="using:SocialStuff.ViewModels"
    xmlns:model="using:SocialStuff.Model"
    Background="#0d0c12">

    <Page.DataContext>
        <vm:CreateChatViewModel/>
    </Page.DataContext>

    <Grid Padding="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>

        <!-- Left Side - Available Friends -->
        <StackPanel Grid.Column="0" Margin="10">
            <TextBlock Text="New Group" FontSize="24" Foreground="White" Margin="0,0,0,10"/>
            <TextBox PlaceholderText="Group Name" Text="{Binding GroupName, Mode=TwoWay}" Margin="0,0,0,10"/>

            <TextBlock Text="Friends" FontSize="18" Foreground="White" Margin="0,10,0,5"/>
            <TextBox x:ConnectionId='4' x:Name="SearchBox"
                     Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     PlaceholderText="Search..."
                     Margin="0,0,0,10"/>

            <ScrollViewer Height="300">
                <ListView ItemsSource="{Binding FilteredFriends}" SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate                        >
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding username}" Foreground="White" Width="100"/>
                                <Button Content="+" 
                                        Command="{Binding DataContext.AddFriendCommand, ElementName=CreateChat}" 
                                        CommandParameter="{Binding}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </ScrollViewer>
        </StackPanel>

        <!-- Right Side - Selected Friends -->
        <Grid Grid.Column="1" Background="#403d52" Padding="10">
            <StackPanel>
                <TextBlock Text="Added Friends" FontSize="18" Foreground="Black" Margin="0,0,0,10"/>
                <ScrollViewer Height="300">
                    <ListView ItemsSource="{Binding SelectedFriends}">
                        <ListView.ItemTemplate>
                            <DataTemplate                        >
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding username}" Foreground="Black"/>
                                    <Button Content="-" 
                                            Command="{Binding DataContext.RemoveFriendCommand, ElementName=CreateChat}" 
                                            CommandParameter="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </ScrollViewer>
            </StackPanel>

            <Button Content="Create Chat" Command="{Binding CreateChatCommand}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="10"/>
        </Grid>
    </Grid>
</Page>

